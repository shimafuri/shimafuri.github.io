webpackJsonp([1],{NHnr:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=n("7+uW"),a=n("rifk"),r=n.n(a),l=n("c/Tr"),i=n.n(l),s=n("d7EF"),c=n.n(s),d=n("Gu7T"),h=n.n(d),u=n("BO1k"),p=n.n(u),f=n("mvHQ"),v=n.n(f),g=n("+pc6"),w=n("bYsw"),I={barWidth:128,barWidthMin:4,barWidthMax:2048,granularity:120,getNormalizedScale:function(e){var t=void 0;return t=JSON.parse(v()(e)),t=t.map(function(t){return(t-e[0]+12)%12})},getScaleNames:function(e){if(null==e)throw new Error("Invalid scale: "+v()(e));var t=I.getNormalizedScale(e);switch(v()(t)){case v()([0,2,4,5,7,9,11]):return I.getNoteNames(e[0]).map(function(e){return e+" major"});case v()([0,2,3,5,7,8,10]):return I.getNoteNames(e[0]).map(function(e){return e+" minor"});default:return"Unknown scale ("+e.join(", ")+")"}},getNoteNames:function(e){switch(e){case 0:return["C"];case 1:return["C#","Db"];case 2:return["D"];case 3:return["D#","Eb"];case 4:return["E"];case 5:return["F"];case 6:return["F#","Gb"];case 7:return["G"];case 8:return["G#","Ab"];case 9:return["A"];case 10:return["A#","Bb"];case 11:return["B"];default:throw new Error("Valid range of pitch class is 0-11.")}},getDegreeLabels:function(e,t){if(null==e)throw new Error("Invalid scale: "+v()(e));var n=I.getNormalizedScale(e),o=(t-e[0]+12)%12;switch(v()(n)){case v()([0,2,4,5,7,9,11]):case v()([0,2,3,5,7,8,10]):return[["I"],["♯I","♭II"],["II"],["♭III"],["III"],["IV"],["♯IV","♭V"],["V"],["♭VI"],["VI"],["♭VII"],["VII"]][o];default:return[["I"],["♯I","♭II"],["II"],["♯II","♭III"],["III"],["IV"],["♯IV","♭V"],["V"],["♯V","♭VI"],["VI"],["♯VI","♭VII"],["VII"]][o]}},getIntervalsFromRoot:function(e,t,n){if(null==e)throw new Error("Invalid scale: "+v()(e));var o=void 0,a=I.getNormalizedScale(e),r=(t-e[0]+12)%12,l=((n-e[0]+12)%12-r+12)%12;switch(v()(a)){case v()([0,2,4,5,7,9,11]):o=[["Root"],["♯1","♭2"],["2"],["♯2","♭3"],["3"],["4"],["♯4","♭5"],["5"],["♯5","♭6"],["6"],["♯6","♭7"],["7"]][l];break;case v()([0,2,3,5,7,8,10]):switch(r){case 0:o=[["Root"],["♭2"],["2"],["3"],["♯3","♭4"],["4"],["♯4","♭5"],["5"],["6"],["♯6","♭7"],["7"],["♯7"]][l];break;case 1:o=[["Root"],["2"],["3"],["♯3","♭4"],["4"],["♯4","♭5"],["5"],["6"],["♯6","♭7"],["7"],["♯7"],["Orig 1st"]][l];break;case 2:o=[["Root"],["2"],["♯2","♭3"],["3"],["♯3","♭4"],["4"],["5"],["♯5","♭6"],["6"],["♯6","♭7"],["7"],["♯7"]][l];break;case 3:o=[["Root"],["♭2"],["2"],["♯2","♭3"],["3"],["4"],["♯4","♭5"],["5"],["♯5","♭6"],["6"],["♯6","♭7"],["7"]][l];break;case 4:o=[["Root"],["2"],["♯2","♭3"],["3"],["4"],["♯4","♭5"],["5"],["♯5","♭6"],["6"],["♯6","♭7"],["7"],["Orig 1st"]][l];break;case 5:o=[["Root"],["♭2"],["2"],["3"],["♯3","♭4"],["4"],["♯4","♭5"],["5"],["♯5","♭6"],["6"],["7"],["♯7"]][l];break;case 6:o=[["Root"],["2"],["3"],["♯3","♭4"],["4"],["♯4","♭5"],["5"],["♯5","♭6"],["6"],["7"],["♯7"],["Orig 1st"]][l];break;case 7:o=[["Root"],["2"],["♯2","♭3"],["3"],["♯3","♭4"],["4"],["♯4","♭5"],["5"],["6"],["♯6","♭7"],["7"],["♯7"]][l];break;case 8:o=[["Root"],["♭2"],["2"],["♯2","♭3"],["3"],["♯3","♭4"],["4"],["5"],["♯5","♭6"],["6"],["♯6","♭7"],["7"]][l];break;case 9:o=[["Root"],["2"],["♯2","♭3"],["3"],["♯3","♭4"],["4"],["5"],["♯5","♭6"],["6"],["♯6","♭7"],["7"],["Orig 1st"]][l];break;case 10:o=[["Root"],["♭2"],["2"],["♯2","♭3"],["3"],["4"],["♯4","♭5"],["5"],["♯5","♭6"],["6"],["7"],["♯7"]][l];break;case 11:o=[["Root"],["2"],["♯2","♭3"],["3"],["4"],["♯4","♭5"],["5"],["♯5","♭6"],["6"],["7"],["♯7"],["Orig 1st"]][l];break;default:throw new Error("Valid range of pitch class is 0-11.")}break;default:throw new Error("This scale is not supported: "+a)}return o},getTransposeDistance:function(e){if(null==e)throw new Error("Invalid scale: "+v()(e));var t=I.getNormalizedScale(e);switch(v()(t)){case v()([0,2,4,5,7,9,11]):switch(e[0]){case 0:case 1:case 2:case 3:case 4:case 5:return e[0];case 6:case 7:case 8:case 9:case 10:case 11:return-(12-e[0])}case v()([0,2,3,5,7,8,10]):switch(e[0]){case 9:case 10:case 11:case 0:case 1:case 2:return(e[0]-9+12)%12;case 3:case 4:case 5:case 6:case 7:case 8:return-(12-(e[0]-9+12)%12)}case null:return 0;default:return console.error("Unknown scale ("+e.join(", ")+")"),0}},getPositionInCollapseMode:function(e,t){console.log("originalScale: "+e+", pitch: "+t);for(var n=0,o=127+(I.getTransposeDistance(e)+6);o>t;o--)e.includes(o%12)&&(n+=1);return n}},b=function(e){for(var t=0,n=0;e;)t+=e.offsetLeft-e.scrollLeft+e.clientLeft,n+=e.offsetTop-e.scrollTop+e.clientTop,e=e.offsetParent;return{x:t,y:n}},x={name:"app",data:function(){return{global:I,flagCollapse:!1,msg:"Welcome to Your Vue.js App",pitchMax:127,pitchMin:0,pitchHeight:16,pitchHeightMin:2,pitchHeightMax:21,scaleIntervals:[{id:Math.random(),duration:491520,scale:null,chordIntervals:[{id:Math.random(),localOffset:0,duration:491520,chord:null,notes:[]}]}],selectedNotes:[],playingOffset:0,midiAccess:null,midiInputs:null,midiOutputs:null,selectedMidiInputs:[],isNoteOn:{}}},watch:{isNoteOn:{handler:function(e,t){console.log("new: %s, old: %s",e,t)},deep:!0}},computed:{pitches:function(){for(var e=[],t=this.pitchMin;t<=this.pitchMax;t++)e.unshift(t);return e},totalDuration:function(){var e=0,t=!0,n=!1,o=void 0;try{for(var a,r=p()(this.scaleIntervals);!(t=(a=r.next()).done);t=!0){e+=a.value.duration}}catch(e){n=!0,o=e}finally{try{!t&&r.return&&r.return()}finally{if(n)throw o}}return e}},methods:{rerender:function(){!function e(t){if(t.$forceUpdate(),t.$children.length>0)for(var n=0;n<t.$children.length;n++)e(t.$children[n])}(this)},playingScale:function(){var e=null,t=this.playingOffset,n=!0,o=!1,a=void 0;try{for(var r,l=p()(this.scaleIntervals);!(n=(r=l.next()).done);n=!0){var i=r.value;if(t>=0&&t<i.duration){e=i.scale;break}t-=i.duration}}catch(e){o=!0,a=e}finally{try{!n&&l.return&&l.return()}finally{if(o)throw a}}return e},transposeDistance:function(){return I.getTransposeDistance(this.playingScale())},divideDuration:function(e,t){for(var n=[],o=0;o+t<e;o+=t)n.push({localOffset:o,duration:t});return n.push({localOffset:o,duration:e-o}),n},onWheel:function(e){e.ctrlKey&&(e.shiftKey?(0!==e.deltaY&&(e.deltaY<0?2*I.barWidth<=I.barWidthMax&&(I.barWidth*=2):e.deltaY>0&&I.barWidth/2>=I.barWidthMin&&(I.barWidth/=2)),e.stopPropagation(),e.preventDefault()):(0!==e.deltaY&&(e.deltaY<0?this.pitchHeight+2<=this.pitchHeightMax&&(this.pitchHeight+=2):e.deltaY>0&&this.pitchHeight-2>=this.pitchHeightMin&&(this.pitchHeight-=2)),e.stopPropagation(),e.preventDefault()))},onDelete:function(){var e=this;this.scaleIntervals.forEach(function(t){t.chordIntervals.forEach(function(t){e.selectedNotes.forEach(function(e){var n=t.notes.findIndex(function(t){return t===e});-1!==n&&t.notes.splice(n,1)})})})},onBackSpace:function(){!!navigator.platform.match(/(Mac|iPhone|iPod|iPad)/i)&&this.onDelete()},onDragOver:function(e){e.stopPropagation(),e.preventDefault()},onDrop:function(e){var t=this;e.stopPropagation(),e.preventDefault();var n=e.dataTransfer.files;if(n)if(1===n.length){var o=n[0];alert(o.name+" ("+o.type+") - "+o.size+" bytes ("+o.lastModifiedDate.toLocaleDateString()+")");var a=new FileReader;a.onloadstart=function(e){console.log(e)},a.onprogress=function(e){console.log(e)},a.onloadend=function(e){console.log(e)},a.onload=function(e){console.log(e);var n=new g(a.result);switch(n.header.getFormat()){case 0:var o=n.tracks[0].getTrackContent(),r=w.createParser(o);t.scaleIntervals.length=0;for(var l=[],i=new Array(16).fill(new Array(128)),s=0;s<i.length;s++)for(var c=0;c<i[s].length;c++)i[s][c]={isOn:!1,onTime:null};for(var d=void 0,h=0;d=r.next();)switch(h+=d.delta,d.type){case w.EVENT_MIDI:switch(d.subtype){case w.EVENT_MIDI_NOTE_OFF:if(9===d.channel)break;var u=i[d.channel][d.param1];!0===u.isOn&&(l.push({id:Math.random(),channel:d.channel,localOffset:u.onTime,duration:h-u.onTime,pitch:d.param1}),u.isOn=!1,u.onTime=null);break;case w.EVENT_MIDI_NOTE_ON:if(9===d.channel)break;var p=i[d.channel][d.param1];!1===p.isOn?(p.isOn=!0,p.onTime=h):p.onTime===h||(l.push({id:Math.random(),channel:d.channel,localOffset:p.onTime,duration:h-p.onTime,pitch:d.param1}),p.onTime=h)}}t.scaleIntervals.push({id:Math.random(),duration:h,scale:null,chordIntervals:[{id:Math.random(),localOffset:0,duration:h,chord:null,notes:l}]});break;case 1:alert("Format 1 is not supported!");break;case 2:return void alert("Format 2 is not supported!")}},a.onabort=function(e){console.log(e)},a.onerror=function(e){console.log(e)},a.readAsArrayBuffer(o)}else alert("Please specify a single file.");else alert("Please drop a file.")},onScroll_headerPane:function(e){e.target.scrollLeftAtLatestScrollEvent=e.target.scrollLeft,this.$refs.notesPane.scrollLeftAtLatestScrollEvent&&this.$refs.notesPane.scrollLeftAtLatestScrollEvent===e.target.scrollLeft||(this.$refs.notesPane.scrollLeft=e.target.scrollLeft)},onScroll_pitchesPane:function(e){e.target.scrollTopAtLatestScrollEvent=e.target.scrollTop,null!=this.$refs.notesPane.scrollTopAtLatestScrollEvent&&this.$refs.notesPane.scrollTopAtLatestScrollEvent===e.target.scrollTop||(this.$refs.notesPane.scrollTop=e.target.scrollTop)},onScroll_notesPane:function(e){e.target.scrollLeftAtLatestScrollEvent=e.target.scrollLeft,e.target.scrollTopAtLatestScrollEvent=e.target.scrollTop,null!=this.$refs.headerPane.scrollLeftAtLatestScrollEvent&&this.$refs.headerPane.scrollLeftAtLatestScrollEvent===e.target.scrollLeft||(this.$refs.headerPane.scrollLeft=e.target.scrollLeft),null!=this.$refs.pitchesPane.scrollTopAtLatestScrollEvent&&this.$refs.pitchesPane.scrollTopAtLatestScrollEvent===e.target.scrollTop||(this.$refs.pitchesPane.scrollTop=e.target.scrollTop)},onMouseUp_BeatsBar:function(e){this.playingOffset=Math.round((this.$refs.headerPane.scrollLeft+e.pageX-b(e.target).x)/e.target.offsetWidth*this.totalDuration)},onNewScaleInterval:function(e,t,n){var o=this.scaleIntervals.findIndex(function(t){return t===e}),a=this.scaleIntervals;Array.prototype.splice.apply(a,[o,1].concat(h()(this.divideScaleInterval(a[o],t+n,[0,2,4,5,7,9,11],null)))),Array.prototype.splice.apply(a,[o,1].concat(h()(this.divideScaleInterval(a[o],t,null,[0,2,4,5,7,9,11])))),this.rerender()},onNewChordInterval:function(e,t,n,o){var a=e.chordIntervals.findIndex(function(e){return e===t}),r=null!=e?e.scale[0]:0,l=e.chordIntervals;Array.prototype.splice.apply(l,[a,1].concat(h()(this.divideChordInterval(l[a],n+o,[r],null)))),Array.prototype.splice.apply(l,[a,1].concat(h()(this.divideChordInterval(l[a],n,null,[r])))),this.rerender()},onNewNote:function(e,t,n,o){var a={id:Math.random(),localOffset:t,duration:n,pitch:o};e.notes.push(a),this.selectedNotes.length=0,this.selectedNotes.push(a)},divideScaleInterval:function(e,t,n,o){if(t===e.duration)return[{id:Math.random(),duration:e.duration,scale:n,chordIntervals:e.chordIntervals}];if(0===t)return[{id:Math.random(),duration:e.duration,scale:o,chordIntervals:e.chordIntervals}];for(var a={id:Math.random(),duration:t,scale:n,chordIntervals:[]},r={id:Math.random(),duration:e.duration-t,scale:o,chordIntervals:[]},l=!1,i=null,s=0;s<e.chordIntervals.length;s++){e.chordIntervals[s];if(s===e.chordIntervals.length-1){l=!0,i=s;break}if(s<e.chordIntervals.length-1){var d=e.chordIntervals[s+1];if(d.localOffset===t){l=!1,i=s;break}if(d.localOffset>t){l=!0,i=s;break}}}for(var h=0;h<=i-1;h++)a.chordIntervals.push(e.chordIntervals[h]);var u=e.chordIntervals[i];if(l){var p=this.divideChordInterval(e.chordIntervals[i],t-u.localOffset,u.chord,u.chord),f=c()(p,2),v=f[0],g=f[1];g.localOffset-=t,a.chordIntervals.push(v),r.chordIntervals.push(g)}else a.chordIntervals.push(u);for(var w=i+1;w<e.chordIntervals.length;w++)e.chordIntervals[w].localOffset-=t,r.chordIntervals.push(e.chordIntervals[w]);return[a,r]},divideChordInterval:function(e,t,n,o){for(var a={id:Math.random(),localOffset:e.localOffset,duration:t,chord:n,notes:[]},r={id:Math.random(),localOffset:e.localOffset+t,duration:e.duration-t,chord:o,notes:[]},l=0;l<e.notes.length;l++){var i=e.notes[l];i.localOffset<t?a.notes.push(i):(i.localOffset-=t,r.notes.push(i))}return[a,r]},startMidiInputConfiguration:function(){var e=this;(null!=this.midiAccess||window.confirm("All Input/Output MIDI devices will be locked after configuring input MIDI devices. Are you sure?"))&&(this.$modal.show("midi-input-configuration"),null==this.midiAccess&&setTimeout(function(){navigator.requestMIDIAccess({sysex:!1,software:!1}).then(function(t){console.log(t),e.midiAccess=t,e.midiAccess.onstatechange=function(n){console.log(n),console.log("MIDI access state is changed. Updating MIDI inputs/outputs array..."),e.midiInputs=i()(t.inputs.values()),e.midiOutputs=i()(t.outputs.values())},console.log("MIDI access is established. Updating MIDI inputs/outputs array..."),e.midiInputs=i()(t.inputs.values()),e.midiOutputs=i()(t.outputs.values()),console.log(e.midiInputs),console.log(e.midiOutputs)}).catch(function(e){throw console.error("Failed to get MIDI access."),e}).then(function(){})},500))},disconnectMidiInput:function(){window.confirm("You need to reload the page to disconnect MIDI devices and make them available for other DAW applications. Are you sure?")&&location.reload()},onMidiInputChannelToggled:function(e,t,n){var o=this;console.log(e+", "+t+", "+n);var a=this.selectedMidiInputs.find(function(t){return t.ref===e});if(null==a){if(n){var r={ref:e,channels:[t],midiMessageListener:function(t){console.log("["+e.name+"]");var n="MIDI message received at timestamp "+t.timestamp+"["+t.data.length+" bytes]: ";for(var a=0;a<t.data.length;a++)n+="0x"+t.data[a].toString(16)+" ";switch(console.log(n),t.data[0]){case 128:var r=t.data[1]+o.transposeDistance();if(r<0||r>127)break;o.isNoteOn[r]=!1,MIDI.noteOff(0,r,0);break;case 144:var l=t.data[1]+o.transposeDistance();if(l<0||l>127)break;o.isNoteOn[l]=!0,MIDI.noteOn(0,l,100,0);break;default:console.error("Unsupported MIDI message type: "+t.data[0])}console.log(o.isNoteOn)}};this.selectedMidiInputs.push(r),e.onmidimessage=r.midiMessageListener}}else n?a.channels.push(t):(a.channels.splice(a.channels.findIndex(function(e){return e===t}),1),0===a.channels.length&&(a.ref.onmidimessage=null,this.selectedMidiInputs.splice(this.selectedMidiInputs.findIndex(function(e){return e===a}),1)))}},components:{"pitch-row":{template:"\n        <div :class=\"{\n          'pitch-row': true,\n          }\" :style=\"{\n          'position': 'relative',\n          'width': '100%',\n          'height': '100%',\n          'transform-style': 'preserve-3d',\n          }\">\n          \x3c!-- Mouse down detector --\x3e\n          <div :style=\"{\n                  'position': 'absolute',\n                  'top': '0',\n                  'left': '0',\n                  'width': '100%',\n                  'height': '100%',\n                }\"\n                @mousedown=\"onMouseDown\">\n          </div>\n          \x3c!-- Notes --\x3e\n          <note v-for=\"note in chordInterval.notes\" :key=\"note.id\" v-if=\"note.pitch == pitch\" :scale-interval=\"scaleInterval\" :chord-interval=\"chordInterval\" :note=\"note\" :selected-notes=\"selectedNotes\"\n            :class=\"{\n              'selected': selectedNotes.includes(note),\n            }\"\n            :style=\"{\n              'position': 'absolute',\n              'top': '0',\n              'left': ((note.localOffset / 1920.0) * global.barWidth) + 'px',\n              'width': ((note.duration / 1920.0) * global.barWidth) + 'px',\n              'height': '100%',\n          }\" />\n          \x3c!-- Input indicator --\x3e\n          <note :scale-interval=\"scaleInterval\" :chord-interval=\"chordInterval\" :note=\"{pitch: pitch}\"\n            :style=\"{\n              'position': 'absolute',\n              'top': '0',\n              'left': ((newNoteLocalOffset / 1920.0) * global.barWidth) + 'px',\n              'width': ((newNoteDuration / 1920.0) * global.barWidth) + 'px',\n              'height': '100%',\n              'display': inputting ? 'flex !important' : 'none !important',\n              'background-color': 'white !important',\n              'color': 'black !important',\n          }\" />\n          </div>\n        </div>\n      ",data:function(){return{global:I,notesPane:null,inputting:!1,newNoteLocalOffset:null,newNoteDuration:null}},props:["scaleInterval","chordInterval","pitch","selectedNotes"],methods:{onMouseDown:function(e){var t=this;this.inputting=!0,MIDI.noteOn(0,this.pitch,100,0);var n=function(e){t.newNoteDuration=Math.round((t.notesPane.scrollLeft+e-b(t.$el).x+1)/t.$el.offsetWidth*t.chordInterval.duration)-t.newNoteLocalOffset,t.newNoteDuration<I.granularity&&(t.newNoteDuration=I.granularity),t.newNoteDuration%I.granularity!=0&&(t.newNoteDuration=t.newNoteDuration-t.newNoteDuration%I.granularity+I.granularity)};this.newNoteLocalOffset=Math.round((this.notesPane.scrollLeft+e.pageX-b(this.$el).x)/this.$el.offsetWidth*this.chordInterval.duration),this.newNoteLocalOffset=this.newNoteLocalOffset-this.newNoteLocalOffset%I.granularity,n(e.pageX);var o=void 0,a=void 0;o=function(e){n(e.pageX)},a=function(e){window.removeEventListener("mousemove",o),window.removeEventListener("mouseup",a),MIDI.noteOff(0,t.pitch,0),t.$emit("new-note",t.chordInterval,t.newNoteLocalOffset,t.newNoteDuration,t.pitch),t.inputting=!1,t.newNoteLocalOffset=null,t.newNoteDuration=null},window.addEventListener("mousemove",o),window.addEventListener("mouseup",a)}},mounted:function(){try{this.notesPane=this.$parent.$refs.notesPane||this.$parent.$parent.$refs.notesPane||this.$parent.$parent.$parent.$refs.notesPane}catch(e){throw console.error("Notes pane is not found!"),e}},components:{note:{template:"\n            <div class=\"note\"\n                  :style=\"{\n                  'display': 'flex',\n                  'align-items': 'center',\n                  'white-space': 'nowrap',\n                  'box-sizing': 'border-box',\n                  'border': ((this.scaleInterval.scale == null ? false : (this.chordInterval.chord == null ? false : this.note.pitch % 12 === this.chordInterval.chord[0])) ? '1px white solid' : '1px black solid'),\n                  'padding-left': '4px',\n                  'font-size': '10px',\n                  'overflow': 'hidden',\n                  'text-align': 'left',\n              }\"\n              @mousedown=\"onMouseDown\"\n            >\n              <template v-if=\"scaleInterval.scale != null\">\n                <template v-if=\"chordInterval.chord != null\">\n              <template v-if=\"chordInterval.chord[0] !== note.pitch % 12\">\x3c!-- Show the degree label if it is a root tone --\x3e\n                {{global.getIntervalsFromRoot(scaleInterval.scale, chordInterval.chord[0], note.pitch % 12).join(' or ')}}\n              </template>\n              <template v-else>\n                  {{global.getDegreeLabels(scaleInterval.scale, note.pitch % 12).join(' or ')}}\n                </template>\n            </template>\n                <template v-else>\n                  {{global.getDegreeLabels(scaleInterval.scale, note.pitch % 12).join(' or ')}}\n                </template>\n              </template>\n              <template v-else>\n                {{global.getNoteNames(note.pitch % 12).join(' or ')}}\n              </template>\n            </div>\n          ",data:function(){return{global:I}},props:["scaleInterval","chordInterval","note","selectedNotes"],methods:{onMouseDown:function(e){var t=this;MIDI.noteOn(0,this.note.pitch,100,0),e.shiftKey||(this.selectedNotes.length=0),this.selectedNotes.push(this.note);var n=void 0;n=function(e){window.removeEventListener("mouseup",n),MIDI.noteOff(0,t.note.pitch,0)},window.addEventListener("mouseup",n)}}}}},"scale-interval-indicator":{template:"\n        \x3c!-- Wrapper --\x3e\n        <div :style=\"{\n                'position': 'relative',\n                'width': ((scaleInterval.duration / 1920.0) * global.barWidth) + 'px',\n                'height': '100%',\n              }\">\n          \x3c!-- Mouse down detector --\x3e\n          <div :style=\"{\n                  'position': 'absolute',\n                  'top': '0',\n                  'left': '0',\n                  'width': '100%',\n                  'height': '24px',\n                }\"\n                @mousedown=\"onMouseDown\">\n          </div>\n          \x3c!-- Indicator --\x3e\n          <div v-show=\"scaleInterval.scale != null\"\n               :style=\"{\n                  'display': 'flex',\n                  'align-items': 'center',\n                  'position': 'absolute',\n                  'top': '0',\n                  'left': '0',\n                  'box-sizing': 'border-box',\n                  'padding-left': '6px',\n                  'width': '100%',\n                  'height': '24px',\n                  'background-color': 'white',\n                  'box-shadow': 'inset 0 0 2px black',\n                  'font-size': '14px',\n                  'font-weight': 'bold',\n                }\"\n                @wheel=\"onWheel\">\n            <template v-if=\"scaleInterval.scale != null\">\n              {{global.getScaleNames(scaleInterval.scale).join(' / ')}}\n            </template>\n          </div>\n          \x3c!-- Input indicator --\x3e\n          <div v-show=\"inputting\"\n               :style=\"{\n                  'position': 'absolute',\n                  'top': '0',\n                  'left': ((newIntervalLocalOffset / 1920.0) * global.barWidth) + 'px',\n                  'width': ((newIntervalDuration / 1920.0) * global.barWidth) + 'px',\n                  'height': '24px',\n                  'background-color': 'white',\n                  'box-shadow': 'inset 0 0 2px black',\n                  'pointer-events': 'none',\n                  }\">\n          </div>\n          \x3c!-- Child chord intervals --\x3e\n          <template v-for=\"chd in scaleInterval.chordIntervals\">\n            <div :style=\"{\n                    'position': 'absolute',\n                    'top': '24px',\n                    'left': ((chd.localOffset / 1920.0) * global.barWidth) + 'px',\n                    'width': ((chd.duration / 1920.0) * global.barWidth) + 'px',\n                    'height': '24px',\n                  }\">\n              <chord-interval-indicator :scaleInterval=\"scaleInterval\" :chordInterval=\"chd\" @new-chord-interval=\"onNewChordInterval\" />\n            </div>\n          </template>\n        </div>\n      ",data:function(){return{global:I,headerPane:null,inputting:!1,newIntervalLocalOffset:null,newIntervalDuration:null}},props:["scaleInterval"],methods:{onNewChordInterval:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];this.$emit.apply(this,["new-chord-interval"].concat(h()(t)))},onMouseDown:function(e){var t=this;if(null==this.scaleInterval.scale){this.inputting=!0;var n=function(e){t.newIntervalDuration=Math.round((t.headerPane.scrollLeft+e-b(t.$el).x+1)/t.$el.offsetWidth*t.scaleInterval.duration)-t.newIntervalLocalOffset,t.newIntervalDuration<I.granularity?t.newIntervalDuration=I.granularity:t.newIntervalLocalOffset+t.newIntervalDuration>t.scaleInterval.duration&&(t.newIntervalDuration=t.scaleInterval.duration-t.newIntervalLocalOffset),t.newIntervalDuration%I.granularity!=0&&(t.newIntervalDuration=t.newIntervalDuration-t.newIntervalDuration%I.granularity+I.granularity)};this.newIntervalLocalOffset=Math.round((this.headerPane.scrollLeft+e.pageX-b(this.$el).x)/this.$el.offsetWidth*this.scaleInterval.duration),this.newIntervalLocalOffset=this.newIntervalLocalOffset-this.newIntervalLocalOffset%I.granularity,n(e.pageX);var o=void 0,a=void 0;o=function(e){n(e.pageX)},a=function(e){window.removeEventListener("mousemove",o),window.removeEventListener("mouseup",a),t.$emit("new-scale-interval",t.scaleInterval,t.newIntervalLocalOffset,t.newIntervalDuration),t.inputting=!1,t.newIntervalLocalOffset=null,t.newIntervalDuration=null},window.addEventListener("mousemove",o),window.addEventListener("mouseup",a)}},onWheel:function(e){if(e.deltaY>0)this.scaleInterval.scale=this.scaleInterval.scale.map(function(e){return(e+11)%12});else{if(!(e.deltaY<0))return;this.scaleInterval.scale=this.scaleInterval.scale.map(function(e){return(e+1)%12})}(this.$parent.rerender||this.$parent.$parent.rerender||this.$parent.$parent.$parent.rerender)()}},beforeCreate:function(){console.log("C major - 127 - 123"),console.log(I.getPositionInCollapseMode([0,2,4,5,7,9,11],127)),console.log(I.getPositionInCollapseMode([0,2,4,5,7,9,11],126)),console.log(I.getPositionInCollapseMode([0,2,4,5,7,9,11],125)),console.log(I.getPositionInCollapseMode([0,2,4,5,7,9,11],124)),console.log(I.getPositionInCollapseMode([0,2,4,5,7,9,11],123)),console.log("C-6 major - 127 - 123"),console.log(I.getPositionInCollapseMode([0,2,4,5,7,9,11].map(function(e){return(e+6)%12}),127)),console.log(I.getPositionInCollapseMode([0,2,4,5,7,9,11].map(function(e){return(e+6)%12}),126)),console.log(I.getPositionInCollapseMode([0,2,4,5,7,9,11].map(function(e){return(e+6)%12}),125)),console.log(I.getPositionInCollapseMode([0,2,4,5,7,9,11].map(function(e){return(e+6)%12}),124)),console.log(I.getPositionInCollapseMode([0,2,4,5,7,9,11].map(function(e){return(e+6)%12}),123))},mounted:function(){try{this.headerPane=this.$parent.$refs.headerPane||this.$parent.$parent.$refs.headerPane||this.$parent.$parent.$parent.$refs.headerPane}catch(e){throw console.error("Header pane is not found!"),e}},components:{"chord-interval-indicator":{template:"\n            \x3c!-- Wrapper --\x3e\n            <div :style=\"{\n                    'position': 'relative',\n                    'width': '100%',\n                    'height': '100%',\n                  }\">\n              \x3c!-- Mouse down detector --\x3e\n              <div :style=\"{\n                      'position': 'absolute',\n                      'top': '0',\n                      'left': '0',\n                      'width': '100%',\n                      'height': '100%',\n                    }\"\n                    @mousedown=\"onMouseDown\">\n              </div>\n              \x3c!-- Indicator --\x3e\n              <div v-show=\"chordInterval.chord != null\"\n                  :style=\"{\n                      'display': 'flex',\n                      'align-items': 'center',\n                      'position': 'absolute',\n                      'top': '0',\n                      'left': '0',\n                      'box-sizing': 'border-box',\n                      'padding-left': '6px',\n                      'width': '100%',\n                      'height': '100%',\n                      'background-color': 'white',\n                      'box-shadow': 'inset 0 0 2px black',\n                      'font-size': '14px',\n                      'font-weight': 'bold',\n                    }\"\n                    @wheel=\"onWheel\">\n                {{chordInterval.chord === void 0 ? 'undefined' : JSON.stringify(chordInterval.chord)}}\n              </div>\n              \x3c!-- Input indicator --\x3e\n              <div v-show=\"inputting\"\n                  :style=\"{\n                      'position': 'absolute',\n                      'top': '0',\n                      'left': ((newIntervalLocalOffset / 1920.0) * global.barWidth) + 'px',\n                      'width': ((newIntervalDuration / 1920.0) * global.barWidth) + 'px',\n                      'height': '100%',\n                      'background-color': 'white',\n                      'box-shadow': 'inset 0 0 2px black',\n                      'pointer-events': 'none',\n                      }\">\n              </div>\n            </div>\n          ",data:function(){return{global:I,headerPane:null,inputting:!1,newIntervalLocalOffset:null,newIntervalDuration:null}},props:["scaleInterval","chordInterval"],methods:{onMouseDown:function(e){var t=this;if(null==this.chordInterval.chord){this.inputting=!0;var n=function(e){t.newIntervalDuration=Math.round((t.headerPane.scrollLeft+e-b(t.$el).x+1)/t.$el.offsetWidth*t.chordInterval.duration)-t.newIntervalLocalOffset,t.newIntervalDuration<I.granularity?t.newIntervalDuration=I.granularity:t.newIntervalLocalOffset+t.newIntervalDuration>t.chordInterval.duration&&(t.newIntervalDuration=t.chordInterval.duration-t.newIntervalLocalOffset),t.newIntervalDuration%I.granularity!=0&&(t.newIntervalDuration=t.newIntervalDuration-t.newIntervalDuration%I.granularity+I.granularity)};this.newIntervalLocalOffset=Math.round((this.headerPane.scrollLeft+e.pageX-b(this.$el).x)/this.$el.offsetWidth*this.chordInterval.duration),this.newIntervalLocalOffset=this.newIntervalLocalOffset-this.newIntervalLocalOffset%I.granularity,n(e.pageX);var o=void 0,a=void 0;o=function(e){n(e.pageX)},a=function(e){window.removeEventListener("mousemove",o),window.removeEventListener("mouseup",a),t.$emit("new-chord-interval",t.scaleInterval,t.chordInterval,t.newIntervalLocalOffset,t.newIntervalDuration),t.inputting=!1,t.newIntervalLocalOffset=null,t.newIntervalDuration=null},window.addEventListener("mousemove",o),window.addEventListener("mouseup",a)}},onWheel:function(e){if(e.deltaY>0)this.chordInterval.chord[0]=(this.chordInterval.chord[0]+11)%12;else{if(!(e.deltaY<0))return;this.chordInterval.chord[0]=(this.chordInterval.chord[0]+1)%12}this.chordInterval.chord=this.chordInterval.chord.filter(function(e,t,n){return 0===t||e!==n[0]}),(this.$parent.rerender||this.$parent.$parent.rerender||this.$parent.$parent.$parent.rerender)()}},mounted:function(){try{this.headerPane=this.$parent.$parent.$refs.headerPane||this.$parent.$parent.$parent.$refs.headerPane||this.$parent.$parent.$parent.$parent.$refs.headerPane}catch(e){throw console.error("Header pane is not found!"),e}}}}}},beforeCreate:function(){MIDI.loadPlugin({soundfontUrl:"static/vendor/MIDI.js/examples/soundfont/",instrument:"acoustic_grand_piano",onsuccess:function(){MIDI.setVolume(0,127)}})}},m={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{class:{"flag-collapse":e.flagCollapse},staticStyle:{width:"100%",height:"100%","background-color":"rgb(28, 28, 28)",display:"flex","flex-flow":"column nowrap"},attrs:{id:"app"},on:{dragover:function(t){e.onDragOver(t)},drop:function(t){e.onDrop(t)},wheel:e.onWheel}},[e._m(0),e._v(" "),n("div",{staticStyle:{height:"32px",position:"relative"}},[n("div",{staticStyle:{position:"absolute",width:"100%",height:"100%",top:"0",right:"0",bottom:"0",left:"0","background-color":"rgb(94, 101, 108)",display:"flex","flex-flow":"row nowrap"}},[n("div",{staticStyle:{flex:"1",width:"0","background-color":"transparent",display:"flex","flex-flow":"row nowrap","align-items":"center",color:"white","font-size":"12px"}},[n("span",{staticStyle:{display:"inline-block",width:"10px"}}),e._v(" "),n("span",{staticStyle:{display:"inline-block"}},[e._v("MIDI Input:")]),e._v(" "),n("span",{staticStyle:{display:"inline-block",width:"10px"}}),e._v(" "),null!=e.midiAccess?[null!=e.selectedMidiInputs&&e.selectedMidiInputs.length>0?[e._l(e.selectedMidiInputs,function(t){return[e._v("\n              "+e._s(t.ref.name)+"\n              ("+e._s(t.channels.map(function(e){return"CH"+e}).join(", "))+")\n            ")]})]:[e._v("\n            <Connected (No device is selected)>\n          ")]]:[e._v("\n          <Not connected>\n        ")],e._v(" "),n("span",{staticStyle:{display:"inline-block",width:"10px"}}),e._v(" "),n("span",{staticStyle:{display:"inline-block",height:"20px",padding:"0 4px","background-color":"rgba(255, 255, 255, 0.3)"},on:{click:e.startMidiInputConfiguration}},[n("div",{staticStyle:{width:"100%",height:"100%",display:"flex","flex-flow":"row nowrap","align-items":"center"}},[e._v("\n            Configure\n          ")])]),e._v(" "),null!=e.midiAccess?[n("span",{staticStyle:{display:"inline-block",width:"10px"}}),e._v(" "),n("span",{staticStyle:{display:"inline-block",height:"20px",padding:"0 4px","background-color":"rgba(255, 255, 255, 0.3)"},on:{click:e.disconnectMidiInput}},[n("div",{staticStyle:{width:"100%",height:"100%",display:"flex","flex-flow":"row nowrap","align-items":"center"}},[e._v("\n              Disconnect\n            ")])])]:e._e(),e._v("\n        "+e._s(e.playingScale())+"\n      ")],2)]),e._v(" "),n("div",{staticStyle:{position:"absolute",width:"100%",height:"100%",top:"0",right:"0",bottom:"0",left:"0","background-image":"linear-gradient(to top, black 0px, black 1px, transparent 1px, transparent 100%)","pointer-events":"none"}})]),e._v(" "),n("div",{staticStyle:{flex:"1",height:"0",margin:"2px",border:"1px solid black",display:"flex","flex-flow":"column nowrap"},attrs:{tabindex:"0"},on:{keyup:[function(t){if(!("button"in t)&&8!==t.keyCode)return null;e.onBackSpace(t)},function(t){if(!("button"in t)&&46!==t.keyCode)return null;e.onDelete(t)}]}},[e._m(1),e._v(" "),n("div",{staticStyle:{flex:"1",height:"0",display:"flex","flex-flow":"row nowrap"}},[e._m(2),e._v(" "),n("div",{staticStyle:{flex:"1",width:"0","background-color":"rgb(29, 30, 32)",display:"flex","flex-flow":"column nowrap"}},[n("div",{staticStyle:{height:"81px"}},[n("div",{staticStyle:{width:"100%",height:"100%",display:"flex","flex-flow":"row nowrap"}},[n("div",{staticStyle:{width:"64px","background-color":"rgb(39, 42, 45)"}},[n("button",{on:{click:function(t){e.flagCollapse=!e.flagCollapse}}},[e._v(e._s(e.flagCollapse))])]),e._v(" "),n("div",{ref:"headerPane",staticClass:"no-scrollbar-holizontal",staticStyle:{"margin-right":"17px",flex:"1",overflow:"scroll","background-color":"blue"},on:{scroll:function(t){e.onScroll_headerPane(t)}}},[n("div",{style:{display:"flex","flex-flow":"column nowrap",width:e.totalDuration/1920*e.global.barWidth+"px","background-color":"rgb(42, 45, 49)",height:"80px","border-bottom":"1px rgb(31, 33, 36) solid"}},[n("div",{style:{position:"relative",width:"100%",height:"32px"},on:{mouseup:e.onMouseUp_BeatsBar}},[n("div",{style:{position:"absolute",bottom:"1px",left:"0px",width:"100%",height:"1px","background-color":"black","pointer-events":"none"}}),e._v(" "),n("div",{style:{position:"absolute",bottom:"0px",left:"0px",width:"100%",height:"1px","background-color":"rgb(38, 40, 43)","pointer-events":"none"}}),e._v(" "),e._l(e.divideDuration(e.totalDuration,480),function(t){return n("div",{key:t.localOffset,style:{position:"absolute",bottom:"1px",left:t.localOffset/1920*e.global.barWidth+"px",width:"1px",height:"4px","background-color":"white","pointer-events":"none"}})})],2),e._v(" "),n("div",{style:{position:"relative",width:"100%",height:"48px"}},[n("div",{style:{position:"absolute",top:"0px",left:"0px",width:"100%",height:"100%"}},e._l(e.divideDuration(e.totalDuration,480),function(t){return n("div",{key:t.localOffset,style:{position:"absolute",top:"0",left:t.localOffset/1920*e.global.barWidth+"px",width:t.duration/1920*e.global.barWidth+"px",height:"100%","background-image":"linear-gradient(to right, rgb(61, 63, 65) 0, rgb(61, 63, 65) 1px, transparent 1px, transparent 100%)","pointer-events":"none"}})})),e._v(" "),n("div",{style:{position:"absolute",top:"0px",left:"0px",display:"flex","flex-flow":"row nowrap",width:"100%",height:"100%"}},e._l(e.scaleIntervals,function(t){return n("scale-interval-indicator",{key:t.id,attrs:{"scale-interval":t},on:{"new-scale-interval":e.onNewScaleInterval,"new-chord-interval":e.onNewChordInterval}})}))])])])])]),e._v(" "),n("div",{staticStyle:{flex:"1",height:"0"}},[n("div",{staticStyle:{width:"100%",height:"100%",display:"flex","flex-flow":"row nowrap","background-color":"rgb(33, 35, 38)"}},[n("div",{staticStyle:{position:"relative","margin-bottom":"17px",width:"64px","background-color":"green"}},[n("div",{ref:"pitchesPane",staticClass:"no-scrollbar",staticStyle:{position:"absolute",width:"100%",height:"100%",top:"0",right:"0",bottom:"0",left:"0"},on:{scroll:function(t){e.onScroll_pitchesPane(t)}}},[n("div",{style:{width:"100%",height:e.pitches.length*e.pitchHeight+"px","background-color":"rgb(240, 242, 243)"}},e._l(e.pitches,function(t){return n("div",{key:t,class:{"piano-key":!0,"scale-tone":[0,2,4,5,7,9,11].includes(t%12),"non-scale-tone":![0,2,4,5,7,9,11].includes(t%12),"note-on":e.isNoteOn[t]},style:{height:e.pitchHeight+"px"}})}))]),e._v(" "),n("div",{staticStyle:{position:"absolute",width:"100%",height:"100%",top:"0",right:"0",bottom:"0",left:"0","box-shadow":"inset 0px 0px 0px 1px rgb(24, 24, 24)","pointer-events":"none"}})]),e._v(" "),n("div",{ref:"notesPane",staticStyle:{flex:"1",overflow:"scroll","background-color":"rgb(50, 53, 56)"},on:{scroll:function(t){e.onScroll_notesPane(t)}}},[n("div",{style:{display:"flex","flex-flow":"row nowrap",position:"relative",width:e.totalDuration/1920*e.global.barWidth+"px",height:e.pitches.length*e.pitchHeight+"px"}},[e._l(e.scaleIntervals,function(t){return n("div",{key:t.id,style:{display:"flex","flex-flow":"row nowrap","box-sizing":"border-box",width:t.duration/1920*e.global.barWidth+"px",height:"100%"}},e._l(t.chordIntervals,function(o){return n("div",{key:o.id,style:{position:"relative",display:"flex","flex-flow":"column nowrap",width:o.duration/1920*e.global.barWidth+"px",height:"100%"}},[e._l(e.pitches,function(a){return n("div",{key:a,class:{"pitch-row-wrapper":!0,"scale-tone":null==t.scale||t.scale.includes(a%12),"non-scale-tone":null!=t.scale&&!t.scale.includes(a%12),"central-tone":null!=t.scale&&a%12===t.scale[0],"root-tone":null!=t.scale&&null!=o.chord&&a%12===o.chord[0],"note-on":e.isNoteOn[a]},style:{position:"absolute",width:"100%",height:e.pitchHeight+"px",transform:"translate(0, "+e.global.getPositionInCollapseMode(e.flagCollapse&&t.scale||[0,1,2,3,4,5,6,7,8,9,10,11],a)*e.pitchHeight+"px)","transform-style":"preserve-3d"}},[n("pitch-row",{attrs:{"scale-interval":t,"chord-interval":o,pitch:a,"selected-notes":e.selectedNotes},on:{"new-note":e.onNewNote}})],1)}),e._v(" "),e._l(e.divideDuration(o.duration,480),function(a,r){return n("div",{key:a.localOffset,style:{position:"absolute",top:"0",left:a.localOffset/1920*e.global.barWidth+"px",width:a.duration/1920*e.global.barWidth+"px",height:"100%","background-image":"linear-gradient(to right, "+(null==t.scale?"transparent":0===r&&null!=o.chord?"black":"transparent")+" 0, "+(null==t.scale?"transparent":0===r&&null!=o.chord?"black":"transparent")+" 1px, transparent 1px, transparent 100%)","pointer-events":"none"}})})],2)}))}),e._v(" "),e._l(e.divideDuration(e.totalDuration,480),function(t){return n("div",{key:t.localOffset,style:{position:"absolute",top:"0",left:t.localOffset/1920*e.global.barWidth+"px",width:t.duration/1920*e.global.barWidth+"px",height:"100%","background-image":"linear-gradient(to right, rgb(61, 63, 65) 0, rgb(61, 63, 65) 1px, transparent 1px, transparent 100%)","pointer-events":"none"}})}),e._v(" "),n("div",{style:{position:"absolute",top:"0",left:e.playingOffset/1920*e.global.barWidth+"px",width:"1px",height:"100%","background-color":"rgba(255, 255, 255, 0.5)","pointer-events":"none"}})],2)])])])])])]),e._v(" "),n("modal",{attrs:{name:"midi-input-configuration",height:"auto"}},[n("div",{staticStyle:{padding:"14px 16px","font-size":"14px"}},[null!=e.midiAccess?[null!=e.midiInputs?e._l(e.midiInputs,function(t,o){return n("div",{key:t.name,style:{"margin-top":0===o?"0":"12px"}},[e._v("\n            "+e._s(t.name)+"\n            "),e._l([1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16],function(o){return n("div",{key:o,staticStyle:{"margin-left":"16px"}},[n("input",{attrs:{type:"checkbox"},on:{change:function(n){e.onMidiInputChannelToggled(t,o,n.target.checked)}}}),e._v("\n              CH"+e._s(o)+"\n            ")])})],2)}):[n("div",[e._v("MIDI inputs are not available!")])]]:e._e()],2)])],1)},staticRenderFns:[function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticStyle:{height:"32px",position:"relative"}},[t("div",{staticStyle:{position:"absolute",width:"100%",height:"100%",top:"0",right:"0",bottom:"0",left:"0","background-color":"rgb(58, 58, 58)",display:"flex","flex-flow":"row nowrap"}},[t("div",{staticStyle:{width:"100px","background-color":"rgb(40, 40, 40)"}}),this._v(" "),t("div",{staticStyle:{flex:"1",width:"0","background-color":"transparent"}})]),this._v(" "),t("div",{staticStyle:{position:"absolute",width:"100%",height:"100%",top:"0",right:"0",bottom:"0",left:"0","background-image":"linear-gradient(to top, black 0px, black 1px, transparent 1px, transparent 100%)","pointer-events":"none"}})])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticStyle:{height:"36px","background-color":"rgb(94, 101, 108)","border-bottom":"1px solid black",display:"flex","flex-flow":"row nowrap"}},[t("div",{staticStyle:{height:"24px",width:"159px","background-color":"transparent"}}),this._v(" "),t("div",{staticStyle:{height:"100%",width:"32px","background-color":"rgb(63, 140, 191)",display:"flex","flex-flow":"row nowrap","align-items":"center","justify-content":"center","font-size":"7px",color:"white"}},[this._v("\n        Select\n      ")]),this._v(" "),t("div",{staticStyle:{height:"100%",width:"32px","background-color":"rgb(94, 101, 108)",display:"flex","flex-flow":"row nowrap","align-items":"center","justify-content":"center","font-size":"7px",color:"white"}},[this._v("\n        Edit\n      ")])])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticStyle:{width:"192px","background-color":"rgb(29, 30, 32)",display:"flex","flex-flow":"column nowrap"}},[t("div",{staticStyle:{flex:"1",height:"0","background-color":"rgb(94, 101, 108)","margin-right":"1px"}})])}]},y=n("VU/8")(x,m,!1,function(e){n("nZBO")},null,null).exports;o.a.config.productionTip=!1,o.a.use(r.a),window.File&&window.FileReader&&window.FileList&&window.Blob?new o.a({el:"#app",template:"<App/>",components:{App:y}}):alert("The File APIs are not fully supported in this browser.")},nZBO:function(e,t){}},["NHnr"]);
//# sourceMappingURL=app.5bc56c1266afee5fad96.js.map